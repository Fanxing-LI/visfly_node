# EKF configuration for ekf_node
# Adjust process and measurement noise, publish rate, and dt limits.
ekf:
  target_hz: 60.0             # Target EKF update frequency (0 = no limit)
  max_dt: 1.0                 # Max accepted dt between odom messages
  min_dt: 0.0005              # Ignore dt smaller than this (s)
  # --- 滤波策略: EMA + 小窗口MA双重平滑 ---
  ma_window_pos: 20            # 3点滑动平均进一步平滑位置
  ma_window_vel: 20            # 速度保持单点（EMA足够）
  ema_alpha_pos: 0.4         # EMA α (位置) - 更强平滑抑制步伐波动
  ema_alpha_vel: 0.4         # EMA α (速度) - 适度平滑
  # Updated smoothing set (stronger velocity damping)
  # Rationale:
  #  - Reduce q_vel (process noise on velocity) to slow velocity random walk
  #  - Greatly reduce q_acc so acceleration state changes very slowly (acts like bias absorber)
  #  - Increase r_vel so we trust raw (noisy) velocity measurements less -> smoother output
  #  - Keep position settings same (already stable)
  # Std reference: sqrt(value)
  # Profile C (低延迟 + 适度平滑，配合 EMA 使用)
  # 说明：相比之前强平滑，将 q_vel / q_acc 稍增大，提高对真实动态的跟随；
  #       同时适当降低 r_vel / r_pos，减少对量测的抑制，EMA 再做末端平滑。
  q:
    pos: 0.00001      # ↓ 进一步减小位置过程噪声，最强平滑
    vel: 0.00003       # ↓ 减小速度过程噪声
    acc: 0.000005      # ↓ 减小加速度过程噪声
  r:
    pos: 0.2          # ↓ 更信任位置测量，减少EKF内部抖动
    vel: 0.2           # ↑ 较少信任速度测量，更多依赖EKF预测

  # 旧参数参考 (如需回退):
  # old_strong_q:
  #   pos: 0.000003
  #   vel: 0.00003
  #   acc: 0.000005
  # old_strong_r:
  #   pos: 0.0006
  #   vel: 0.060

  # 调参提示:
  #  - 想再快：增大 q_vel (到 1e-4) 或减小 r_vel (到 0.035) 或增大 ema_alpha_vel (到 0.25)。
  #  - 想更稳：减小 ema_alpha_*；或减小 q_* / 增大 r_*；或把 ma_window_* >1 叠加。
  #  - 避免 q_acc < 1e-6，防止模型对真实机动适应变差。